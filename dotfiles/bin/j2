#!/usr/bin/python3
import fire
import yaml
from jinja2 import Template


def j2(file, stdout=False):
    with open(file) as f:
        template = f.read()

    result = Template(template).render(
        yaml=yaml,
        open=lambda f: open(f).read(),
        repr=repr,
    )
    if stdout:
        print(result)
        return

    file2 = file.rsplit('.j2', 1)[0]
    with open(file2, 'w') as f2:
        f2.write(result)


fire.Fire(j2)
